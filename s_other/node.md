# node

## 23 RPC 调用

RPC 通信： Remote Procedure Call(远程过程调用)

就是服务器和服务器通信。

和 Ajax 的相同点：

- 都是计算机之间网络通信
- 需要双方约定一个数据格式

不同点：

- 不一定使用 DNS 作为寻址服务
- 应用层协议一般不使用 HTTP(一般用二进制协议，性能上优势)
- 基于 TCP 或 UDP 协议

寻址/负载均衡

- Ajax: 使用 DNS 进行寻址: 域名 转 ip
- RPC: 使用特有服务进行寻址：如 id 内网通过寻址服务器找 ip，

TCP 通信方式(实现成本)

- 单工通信，只有一方能给一方发数据
- 半双工通信：一定时间内，只有一端能给另一方发数据，也叫轮番单工通信
- 全双工通信： 可以互相发送

单工、半双工：是单向路。双工是双向路。

二进制协议：

- 更小的数据包体积： 1001 001 11 用字节长度来区分三个字，拼起来，不需要额外字段
- 更快的编解码速度

## 24 RPC 调用：buffer 编解码二进制包

buffer 的创建

```
Buffer.from('hello')  // 5位，每位代表unicode码
Buffer.from([1,2,3,4])  // 4位 01 02 03 04
Buffer.alloc(20)  // 20位空的 00
```

写入：

![](imgs/2020-07-28-10-53-25.png)

int8 只占用一个字节，第二个参数是 offset，向第 1 个字节写入。512 占用了 2 个 16 位字节，le,be 是字节排布顺序，可能和设备有关，要具体协商，8 没有 BE，LE 因为只占用一个字节，所以没有顺序。

二进制的编码：根据每个数据进行写入

```
write(1, 0)
write(41, 1)
write(1101, 3)
```

使用库 protocol buffer，用来编码，使用方法

1. 规定数据协议 test.proto
2.

## 25_RPC 调用：net 建立多路复用的 RPC 通道

全双工通信要加上包序号，来组装数据，防止错乱。
