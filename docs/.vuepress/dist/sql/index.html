<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SQL 必知必会</title>
    <meta name="description" content="">
    <link rel="alternate" type="application/rss+xml" href="https://www.banli17.com/rss.xml" title=" RSS Feed">
  <link rel="alternate" type="application/atom+xml" href="https://www.banli17.com/feed.atom" title=" Atom Feed">
  <link rel="alternate" type="application/json" href="https://www.banli17.com/feed.json" title=" JSON Feed">
    
    <link rel="preload" href="/assets/css/0.styles.f0bd4ff2.css" as="style"><link rel="preload" href="/assets/js/app.5c51376b.js" as="script"><link rel="preload" href="/assets/js/2.8c0114de.js" as="script"><link rel="preload" href="/assets/js/6.7b7b0c6e.js" as="script"><link rel="prefetch" href="/assets/js/10.f5d17086.js"><link rel="prefetch" href="/assets/js/11.e20de54a.js"><link rel="prefetch" href="/assets/js/12.875c07b5.js"><link rel="prefetch" href="/assets/js/13.ac63c516.js"><link rel="prefetch" href="/assets/js/14.ee59701a.js"><link rel="prefetch" href="/assets/js/15.b65d88ca.js"><link rel="prefetch" href="/assets/js/16.f28d7fb6.js"><link rel="prefetch" href="/assets/js/17.65437f61.js"><link rel="prefetch" href="/assets/js/18.1e6d0c18.js"><link rel="prefetch" href="/assets/js/19.db67e45c.js"><link rel="prefetch" href="/assets/js/20.cdb246f9.js"><link rel="prefetch" href="/assets/js/21.1e402057.js"><link rel="prefetch" href="/assets/js/22.976c54fb.js"><link rel="prefetch" href="/assets/js/23.400bd9ca.js"><link rel="prefetch" href="/assets/js/24.1ab0fea0.js"><link rel="prefetch" href="/assets/js/25.dca8399b.js"><link rel="prefetch" href="/assets/js/26.3f510309.js"><link rel="prefetch" href="/assets/js/27.4be6345b.js"><link rel="prefetch" href="/assets/js/28.ec0e61c9.js"><link rel="prefetch" href="/assets/js/29.ad085cd6.js"><link rel="prefetch" href="/assets/js/3.c52a547c.js"><link rel="prefetch" href="/assets/js/30.e0ff9b29.js"><link rel="prefetch" href="/assets/js/31.9d48df67.js"><link rel="prefetch" href="/assets/js/32.4ccedb9e.js"><link rel="prefetch" href="/assets/js/33.990e0245.js"><link rel="prefetch" href="/assets/js/34.1a8e25ff.js"><link rel="prefetch" href="/assets/js/35.ce89e0f9.js"><link rel="prefetch" href="/assets/js/36.b616f02d.js"><link rel="prefetch" href="/assets/js/37.28b05409.js"><link rel="prefetch" href="/assets/js/38.fa83c2ce.js"><link rel="prefetch" href="/assets/js/39.3093a101.js"><link rel="prefetch" href="/assets/js/4.b02b09d8.js"><link rel="prefetch" href="/assets/js/40.8411211d.js"><link rel="prefetch" href="/assets/js/41.595d6b06.js"><link rel="prefetch" href="/assets/js/42.5ec23782.js"><link rel="prefetch" href="/assets/js/43.2f977335.js"><link rel="prefetch" href="/assets/js/44.f4931744.js"><link rel="prefetch" href="/assets/js/45.8340b8ea.js"><link rel="prefetch" href="/assets/js/46.a4362cc0.js"><link rel="prefetch" href="/assets/js/47.9056832b.js"><link rel="prefetch" href="/assets/js/48.7d83f040.js"><link rel="prefetch" href="/assets/js/49.5a8bba0d.js"><link rel="prefetch" href="/assets/js/5.2ca983ea.js"><link rel="prefetch" href="/assets/js/50.b19b2f18.js"><link rel="prefetch" href="/assets/js/51.9b454736.js"><link rel="prefetch" href="/assets/js/52.f07e7a17.js"><link rel="prefetch" href="/assets/js/53.40523d34.js"><link rel="prefetch" href="/assets/js/54.75dad187.js"><link rel="prefetch" href="/assets/js/55.d82fa91b.js"><link rel="prefetch" href="/assets/js/56.b9e77e49.js"><link rel="prefetch" href="/assets/js/57.b656231d.js"><link rel="prefetch" href="/assets/js/58.8bdee2f5.js"><link rel="prefetch" href="/assets/js/59.5af11359.js"><link rel="prefetch" href="/assets/js/60.248b21fc.js"><link rel="prefetch" href="/assets/js/61.16f9e45c.js"><link rel="prefetch" href="/assets/js/62.fbfe172e.js"><link rel="prefetch" href="/assets/js/63.1c24a72e.js"><link rel="prefetch" href="/assets/js/64.02887ca4.js"><link rel="prefetch" href="/assets/js/65.a0e24414.js"><link rel="prefetch" href="/assets/js/66.95aeefe1.js"><link rel="prefetch" href="/assets/js/67.4164d4f5.js"><link rel="prefetch" href="/assets/js/68.31c13964.js"><link rel="prefetch" href="/assets/js/69.3fa2a0b4.js"><link rel="prefetch" href="/assets/js/7.1982d55b.js"><link rel="prefetch" href="/assets/js/70.cd57e760.js"><link rel="prefetch" href="/assets/js/71.366e3404.js"><link rel="prefetch" href="/assets/js/72.8f5a65b6.js"><link rel="prefetch" href="/assets/js/73.88bba8d4.js"><link rel="prefetch" href="/assets/js/74.fa057605.js"><link rel="prefetch" href="/assets/js/75.562dab99.js"><link rel="prefetch" href="/assets/js/76.cbd7259e.js"><link rel="prefetch" href="/assets/js/77.6228c89c.js"><link rel="prefetch" href="/assets/js/78.648a874c.js"><link rel="prefetch" href="/assets/js/79.5845013d.js"><link rel="prefetch" href="/assets/js/8.7d22dd42.js"><link rel="prefetch" href="/assets/js/80.c6cca663.js"><link rel="prefetch" href="/assets/js/81.8c48c503.js"><link rel="prefetch" href="/assets/js/82.3b2a2c4d.js"><link rel="prefetch" href="/assets/js/9.2e268c42.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f0bd4ff2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/f2e/html/1.html" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/es6/" class="nav-link">es6</a></li><li class="dropdown-item"><!----> <a href="/jquery/" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/browser/" class="nav-link">浏览器</a></li><li class="dropdown-item"><!----> <a href="/project/" class="nav-link">工程化</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link router-link-exact-active router-link-active">sql 必知必会</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/mongo/" class="nav-link">mongodb</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">nginx</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql/.html" class="nav-link">网络协议</a></li><li class="dropdown-item"><!----> <a href="/sql/.html" class="nav-link">计算机组成原理</a></li><li class="dropdown-item"><!----> <a href="/sql/.html" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algo/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><a href="/task/2020.html" class="nav-link">安排</a></div><div class="nav-item"><a href="https://github.com/banli17" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/f2e/html/1.html" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/es6/" class="nav-link">es6</a></li><li class="dropdown-item"><!----> <a href="/jquery/" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/browser/" class="nav-link">浏览器</a></li><li class="dropdown-item"><!----> <a href="/project/" class="nav-link">工程化</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link router-link-exact-active router-link-active">sql 必知必会</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/mongo/" class="nav-link">mongodb</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">nginx</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql/.html" class="nav-link">网络协议</a></li><li class="dropdown-item"><!----> <a href="/sql/.html" class="nav-link">计算机组成原理</a></li><li class="dropdown-item"><!----> <a href="/sql/.html" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algo/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><a href="/task/2020.html" class="nav-link">安排</a></div><div class="nav-item"><a href="https://github.com/banli17" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SQL 必知必会</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/sql/" class="active sidebar-link">SQL 必知必会</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sql/#_4-ddl" class="sidebar-link">4 DDL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sql/#数据库" class="sidebar-link">数据库</a></li><li class="sidebar-sub-header"><a href="/sql/#修改数据表" class="sidebar-link">修改数据表</a></li><li class="sidebar-sub-header"><a href="/sql/#创建表结构" class="sidebar-link">创建表结构</a></li><li class="sidebar-sub-header"><a href="/sql/#设计数据表的原则" class="sidebar-link">设计数据表的原则</a></li></ul></li><li class="sidebar-sub-header"><a href="/sql/#_5-select-查询数据" class="sidebar-link">5 select 查询数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sql/#select-基础语法" class="sidebar-link">select 基础语法</a></li></ul></li><li class="sidebar-sub-header"><a href="/sql/#_6-数据过滤" class="sidebar-link">6 数据过滤</a></li><li class="sidebar-sub-header"><a href="/sql/#_7-sql-函数" class="sidebar-link">7 SQL 函数</a></li><li class="sidebar-sub-header"><a href="/sql/#_8-聚集函数" class="sidebar-link">8 聚集函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sql/#_5-个聚集函数" class="sidebar-link">5 个聚集函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/sql/#_9-子查询" class="sidebar-link">9 子查询</a></li><li class="sidebar-sub-header"><a href="/sql/#_10-常用的-sql-标准和连接" class="sidebar-link">10 常用的 SQL 标准和连接</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sql-必知必会"><a href="#sql-必知必会" aria-hidden="true" class="header-anchor">#</a> SQL 必知必会</h1> <h2 id="_4-ddl"><a href="#_4-ddl" aria-hidden="true" class="header-anchor">#</a> 4 DDL</h2> <h3 id="数据库"><a href="#数据库" aria-hidden="true" class="header-anchor">#</a> 数据库</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 创建</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> nba<span class="token punctuation">;</span>
<span class="token comment"># 删除</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> nba<span class="token punctuation">;</span>
</code></pre></div><h3 id="修改数据表"><a href="#修改数据表" aria-hidden="true" class="header-anchor">#</a> 修改数据表</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 添加字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> player <span class="token keyword">ADD</span> <span class="token punctuation">(</span>age <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 重命名字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> player <span class="token keyword">RENAME</span> <span class="token keyword">COLUMN</span> age <span class="token keyword">to</span> player_age
<span class="token comment"># 修改字段结构</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> player <span class="token keyword">MODIFY</span> player_age <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 删除字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> player <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> player_age<span class="token punctuation">;</span>
</code></pre></div><h3 id="创建表结构"><a href="#创建表结构" aria-hidden="true" class="header-anchor">#</a> 创建表结构</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>player<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>player<span class="token punctuation">`</span>  <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>player_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>team_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>player_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>height<span class="token punctuation">`</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0.00</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>player_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token punctuation">`</span>player_name<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>player_name<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>
</code></pre></div><p>数据表和字段都使用了反引号，这是为了避免它们的名称与 MySQL 保留字段相同。</p> <p>其中 player_name 字段的字符集是 utf8，排序规则是 utf8_general_ci，代表对大小写不敏感，如果设置为 utf8_bin，代表对大小写敏感。</p> <p>USING BTREE 表示使用索引，还有 HASH 方式。PRIMARY KEY 表示主键，索引有唯一索引(UNIQUE INDEX)和普通索引(NORMAL INDEX)。</p> <p>约束: 目的是保证数据的准确性和一致性。</p> <ul><li>主键约束: 唯一不重复，不能为空，即 UNIQUE + NOT NULL，一个表主键只能有一个，主键可以是一个字段或多个字段复合组成。</li> <li>外键约束：确保表与表之间引用的完整性，一个表中的外键对应另一张表的主键。外键可以重复，也可以为空。</li> <li>唯一性约束：表示字段在表中数值是唯一的。</li> <li>NOT NULL 约束</li> <li>DEFAULT，字段的默认值</li> <li>CHECK 约束，检查值的有效性，比如身高 ，<code>CHECK(height&gt;=0 AND height &lt;3)</code></li></ul> <p>唯一性约束和普通索引的区别：唯一性约束相当于创建了一个约束和普通索引，目的是保证字段的正确性，而普通索引只是提升数据检索的速度，并不对字段的唯一性进行约束。</p> <p>主键、外键和索引</p> <h3 id="设计数据表的原则"><a href="#设计数据表的原则" aria-hidden="true" class="header-anchor">#</a> 设计数据表的原则</h3> <p>思考：</p> <ul><li>用户需要什么数据？需要在数据表中保存哪些数据？哪些数据经常被访问？如何提升检索效率？</li> <li>如何保证数据表数据的正确性，当插入、删除、更新的时候该进行怎样的约束检查？如何降低数据表的数据冗余度，保证数据表不会因为用户量的增长而迅速扩张？</li> <li>如何让负责数据库维护的人员更方便的使用数据库？</li></ul> <p>三少一多原则:</p> <ol><li>数据表的个数越少越好</li></ol> <p>RDBMS 的核心在于对实体和联系的定义，也就是 E-R 图（Entity Relationship Diagram），数据表越少，证明实体和联系设计得越简洁，既方便理解又方便操作。</p> <ol start="2"><li>数据表的字段个数越少越好</li></ol> <p>字段个数越多，数据冗余的可能性越大。设置字段个数少的前提是各个字段相互独立，而不是某个字段的取值可以由其他字段计算出来。当然字段个数少是相对的，我们通常会在数据冗余和检索效率中进行平衡。</p> <ol start="3"><li>数据表中联合主键的字段个数越少越好</li></ol> <p>设置主键是为了确定唯一性，当一个字段无法确定唯一性的时候，就需要采用联合主键的方式（也就是用多个字段来定义一个主键）。联合主键中的字段越多，占用的索引空间越大，不仅会加大理解难度，还会增加运行时间和索引空间，因此联合主键的字段个数越少越好。</p> <ol start="4"><li>使用主键和外键越多越好</li></ol> <p>数据库的设计实际上就是定义各种表，以及各种字段之间的关系。这些关系越多，证明这些实体之间的冗余度越低，利用度越高。这样做的好处在于不仅保证了数据表之间的独立性，还能提升相互之间的关联使用率。</p> <p>“三少一多”原则的核心就是简单可复用。简单指的是用更少的表、更少的字段、更少的联合主键字段来完成数据表的设计。可复用则是通过主键、外键的使用来增强数据表之间的复用率。因为一个主键可以理解是一张表的代表。键设计得越多，证明它们之间的利用率越高。</p> <h2 id="_5-select-查询数据"><a href="#_5-select-查询数据" aria-hidden="true" class="header-anchor">#</a> 5 select 查询数据</h2> <p><img src="/assets/img/5.e114d7ca.png" alt=""></p> <h3 id="select-基础语法"><a href="#select-基础语法" aria-hidden="true" class="header-anchor">#</a> select 基础语法</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 查询列， as别名</span>
<span class="token comment"># 避免使用 *，因为写清列名，可以减少数据表查询的网络传输量，</span>
<span class="token keyword">SELECT</span> name <span class="token keyword">as</span> n<span class="token punctuation">,</span> age <span class="token keyword">as</span> a <span class="token keyword">FROM</span> heros<span class="token punctuation">;</span>


<span class="token comment"># 查询常数，platform 在表中不存在，是 sql 构建出来的，在多表查询时可能有用</span>
<span class="token comment"># 注意要用引号，否则会解析为列名，数字不需要引号</span>
<span class="token keyword">SELECT</span> <span class="token string">'王者荣耀'</span> <span class="token keyword">as</span> platform<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> heros<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+</span>
<span class="token operator">|</span> platform     <span class="token operator">|</span> name         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+</span>
<span class="token operator">|</span> 王者荣耀     <span class="token operator">|</span> 夏侯惇       <span class="token operator">|</span>
<span class="token operator">|</span> 王者荣耀     <span class="token operator">|</span> 钟无艳       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+</span>


<span class="token comment"># 去除重复行，使用 DISTINCT 关键字</span>
<span class="token comment"># DISTINCT需要放到所有列名的前面,</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> attack_range <span class="token keyword">FROM</span> heros<span class="token punctuation">;</span>
<span class="token comment"># 多个列名时它实际是对一个组合（所有列名）的去重</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> attack_range<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> heros<span class="token punctuation">;</span>


<span class="token comment"># 排序 ORDER BY</span>
<span class="token comment"># 排序列名，可以一个或多个</span>
<span class="token comment"># 排序规则，默认 ASC 递增、DESC 递减，如果是字符串，需要看具体设置，如 MYSQL 建字段时 BINARY 属性表示字段区分大小写</span>
<span class="token comment"># 非选择性排序：即SELECT 没有列 name，也可以使用 ORDER BY name</span>
<span class="token comment"># ORDER BY 通常位于 SELECT 最后一条子句，否则会报错</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> hp_max <span class="token keyword">FROM</span> heros <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> mp_max<span class="token punctuation">,</span> hp_max <span class="token keyword">DESC</span>


<span class="token comment"># 约束返回结果的数量 LIMIT</span>
<span class="token comment"># MYSQL 中需要放在最后面</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> hp_max <span class="token keyword">FROM</span> heros <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> hp_max <span class="token keyword">LIMIT</span> <span class="token number">4</span><span class="token punctuation">;</span>
</code></pre></div><p>SELECT 执行顺序</p> <ol><li>关键字顺序</li></ol> <div class="language- extra-class"><pre class="language-text"><code>SELECT ... FROM ... WHERE ... GROUP BY ... HAVING ... ORDER BY ...
</code></pre></div><ol start="2"><li>语句执行顺序</li></ol> <div class="language- extra-class"><pre class="language-text"><code>FROM &gt; WHERE &gt; GROUP BY &gt; HAVING &gt; SELECT的字段 &gt; DISTINCT &gt; ORDER BY &gt; LIMIT
</code></pre></div><p>在 SELECT 语句执行这些步骤的时候，每个步骤都会产生一个虚拟表，然后将这个虚拟表传入下一个步骤中作为输入。</p> <div class="language- extra-class"><pre class="language-text"><code>SELECT DISTINCT player_id, player_name, count(*) as num #顺序5
FROM player JOIN team ON player.team_id = team.team_id #顺序1
WHERE height &gt; 1.80 #顺序2
GROUP BY player.team_id #顺序3
HAVING num &gt; 2 #顺序4
ORDER BY num DESC #顺序6
LIMIT 2 #顺序7
</code></pre></div><p>SQL 的执行原理:</p> <p>首先，你可以注意到，SELECT 是先执行 FROM 这一步的。在这个阶段，如果是多张表联查，还会经历下面的几个步骤：</p> <p>首先先通过 CROSS JOIN 求笛卡尔积，相当于得到虚拟表 vt（virtual table）1-1；
通过 ON 进行筛选，在虚拟表 vt1-1 的基础上进行筛选，得到虚拟表 vt1-2；
添加外部行。如果我们使用的是左连接、右链接或者全连接，就会涉及到外部行，也就是在虚拟表 vt1-2 的基础上增加外部行，得到虚拟表 vt1-3。
当然如果我们操作的是两张以上的表，还会重复上面的步骤，直到所有表都被处理完为止。这个过程得到是我们的原始数据。</p> <p>当我们拿到了查询数据表的原始数据，也就是最终的虚拟表 vt1，就可以在此基础上再进行 WHERE 阶段。在这个阶段中，会根据 vt1 表的结果进行筛选过滤，得到虚拟表 vt2。</p> <p>然后进入第三步和第四步，也就是 GROUP 和 HAVING 阶段。在这个阶段中，实际上是在虚拟表 vt2 的基础上进行分组和分组过滤，得到中间的虚拟表 vt3 和 vt4。这中间会使用聚集函数进行计算，所以第四步 num&gt;2 会在 SELECT 之前就可以使用。</p> <p>当我们完成了条件筛选部分之后，就可以筛选表中提取的字段，也就是进入到 SELECT 和 DISTINCT 阶段。</p> <p>首先在 SELECT 阶段会提取想要的字段，然后在 DISTINCT 阶段过滤掉重复的行，分别得到中间的虚拟表 vt5-1 和 vt5-2。</p> <p>当我们提取了想要的字段数据之后，就可以按照指定的字段进行排序，也就是 ORDER BY 阶段，得到虚拟表 vt6。</p> <p>最后在 vt6 的基础上，取出指定行的记录，也就是 LIMIT 阶段，得到最终的结果，对应的是虚拟表 vt7。</p> <p>当然我们在写 SELECT 语句的时候，不一定存在所有的关键字，相应的阶段就会省略。</p> <p>同时因为 SQL 是一门类似英语的结构化查询语言，所以我们在写 SELECT 语句的时候，还要注意相应的关键字顺序，所谓底层运行的原理，就是我们刚才讲到的执行顺序。</p> <ul><li><p>如何排序检索数据</p></li> <li><p>什么情况下使用 select *，如何提升 select 查询效率？</p></li></ul> <h2 id="_6-数据过滤"><a href="#_6-数据过滤" aria-hidden="true" class="header-anchor">#</a> 6 数据过滤</h2> <p>提升查询效率：约束返回结果的数量，指定筛选条件进行过滤。</p> <p>目标：</p> <ol><li>WHERE 子句 + 比较运算符过滤</li> <li>使用逻辑运算符进行多条件过滤</li> <li>使用通配符进行复杂过滤</li></ol> <p>比较运算符：</p> <div class="language- extra-class"><pre class="language-text"><code>=
&lt;&gt; 或 !=
&lt;
&lt;= 或 !&gt;
&gt;
&gt;= 或 !&lt;
BETWEEN 可以取到边界值
IS NULL
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 查询所有最大生命值大于 6000 的英雄</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> hp_max <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> hp_max <span class="token operator">&gt;</span> <span class="token number">6000</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> hp_max <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> hp_max <span class="token operator">&gt;</span> <span class="token number">6000</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> hp_max<span class="token punctuation">;</span>

<span class="token comment"># 查询所有最大生命值在5399到6811之间的英雄</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> hp_max <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> hp_max <span class="token operator">BETWEEN</span> <span class="token number">5339</span> <span class="token operator">AND</span> <span class="token number">6811</span><span class="token punctuation">;</span>

<span class="token comment"># 对heros表中的hp_max字段进行空值检查</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> hp_max <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> hp_max <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre></div><p>逻辑运算符</p> <div class="language- extra-class"><pre class="language-text"><code>AND 并且
OR 或者
IN  在指定条件范围内
NOT 非
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 筛选最大生命值大于6000，最大法力大于1700的英雄，然后按照最大生命值和最大法力值之和从高到低进行排序</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> hp_max<span class="token punctuation">,</span> mp_max <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> hp_max <span class="token operator">&gt;</span> <span class="token number">6000</span> <span class="token operator">AND</span> mp_max <span class="token operator">&gt;</span> <span class="token number">1700</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>hp_max<span class="token operator">+</span>mp_max<span class="token punctuation">)</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>


<span class="token comment"># 查询最大生命值加最大法力值大于8000的英雄，或者最大生命值大于6000并且最大法力值大于1700的英雄</span>
<span class="token comment"># AND 优先级比 OR 高</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> hp_max<span class="token punctuation">,</span> mp_max <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>hp_max<span class="token operator">+</span>mp_max<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">8000</span> <span class="token operator">OR</span> hp_max <span class="token operator">&gt;</span> <span class="token number">6000</span> <span class="token operator">AND</span> mp_max <span class="token operator">&gt;</span> <span class="token number">1700</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>hp_max<span class="token operator">+</span>mp_max<span class="token punctuation">)</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>

<span class="token comment"># 查询主要定位或者次要定位是法师或是射手的英雄，同时英雄的上线时间不在2016-01-01到2017-01-01之间</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> role_main<span class="token punctuation">,</span> role_assist<span class="token punctuation">,</span> hp_max<span class="token punctuation">,</span> mp_max<span class="token punctuation">,</span> birthdate
<span class="token keyword">FROM</span> heros
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>role_main <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'法师'</span><span class="token punctuation">,</span> <span class="token string">'射手'</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token punctuation">`</span>role_assist<span class="token punctuation">`</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'法师'</span><span class="token punctuation">,</span> <span class="token string">'射手'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>birthdate<span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token operator">BETWEEN</span> <span class="token string">'2016-01-01'</span> <span class="token operator">AND</span> <span class="token string">'2017-01-01'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>hp_max<span class="token operator">+</span>mp_max<span class="token punctuation">)</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre></div><p>使用通配符进行过滤。注意它需要消耗数据库更长的时间来进行匹配。即使对 LIKE 检索的字段进行索引，索引的价值也可能消失。如果要让索引生效，LIKE 后面就不能以 % 开头，如<code>LIKE '%太'</code>会对全表扫描，而<code>LIKE '太%'</code>就不会。</p> <ul><li><code>%</code> 表示 0 到多个字符。</li> <li><code>_</code> 表示 1 个字符。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 名字包含张良的英雄</span>
<span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">'%张良%'</span><span class="token punctuation">;</span>

<span class="token comment"># 匹配东皇太一</span>
<span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">'_%太%'</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 请你编写SQL语句，对英雄名称、主要定位、次要定位、最大生命和最大法力进行查询，筛选条件为：主要定位是坦克或者战士，并且次要定位不为空，同时满足最大生命值大于8000或者最大法力小于1500的英雄，并且按照最大生命和最大法力之和从高到底的顺序进行排序。</span>

<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> role_main<span class="token punctuation">,</span> role_assist<span class="token punctuation">,</span> hp_max<span class="token punctuation">,</span> mp_max
<span class="token keyword">FROM</span> heros
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>role_main <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'坦克'</span><span class="token punctuation">,</span> <span class="token string">'战士'</span><span class="token punctuation">)</span> <span class="token operator">AND</span> role_assist <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> <span class="token punctuation">(</span>hp_max <span class="token operator">&gt;</span> <span class="token number">8000</span> <span class="token operator">OR</span> mp_max <span class="token operator">&lt;</span> <span class="token number">1500</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>hp_max <span class="token operator">+</span> mp_max<span class="token punctuation">)</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/assets/img/6.a187e49a.png" alt=""></p> <h2 id="_7-sql-函数"><a href="#_7-sql-函数" aria-hidden="true" class="header-anchor">#</a> 7 SQL 函数</h2> <p>函数分为内置函数和自定义函数。</p> <p>内置函数：</p> <ul><li>算术函数</li> <li>字符串函数</li> <li>日期函数</li> <li>转换函数(数据类型转换)</li></ul> <p><strong>算术函数</strong></p> <ul><li>ABS() 绝对值</li> <li>MOD() 取余</li> <li>ROUND() 四舍五入为指定的小数位数，需要两个参数：字段名、小数位数</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 2</span>
<span class="token keyword">SELECT</span> ABS<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 2</span>
<span class="token keyword">SELECT</span> <span class="token function">MOD</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 37.3</span>
<span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">37.25</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>字符串函数</strong></p> <ul><li>CONCAT() 将多个字符串拼接起来</li> <li>LENGTH() 计算字段的长度，一个汉字算 3 个字符，一个数字或字母算一个字符</li> <li>CHAR_LENGTH() 计算字段的长度，一个汉字、数字或字母都算一个字符</li> <li>LOWER() 字符串转小写</li> <li>UPPER() 字符串转大写</li> <li>REPLACE() 替换函数，3 个参数分别是要替换的表达式或字段名，要查找的被替换字符串，替换成哪个字符串</li> <li>SUBSTRING() 截取字符串，3 个参数分别是待截取的表达式或字符串，开始截取的位置(从 1 开始)，想要截取的长度</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>，运行结果为abc123。

<span class="token keyword">SELECT</span> LENGTH<span class="token punctuation">(</span><span class="token string">'你好'</span><span class="token punctuation">)</span>，运行结果为<span class="token number">6</span>。

<span class="token keyword">SELECT</span> CHAR_LENGTH<span class="token punctuation">(</span><span class="token string">'你好'</span><span class="token punctuation">)</span>，运行结果为<span class="token number">2</span>。

<span class="token keyword">SELECT</span> LOWER<span class="token punctuation">(</span><span class="token string">'ABC'</span><span class="token punctuation">)</span>，运行结果为abc。

<span class="token keyword">SELECT</span> UPPER<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>，运行结果ABC。

<span class="token keyword">SELECT</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token string">'fabcd'</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>，运行结果为f123d。

<span class="token keyword">SELECT</span> SUBSTRING<span class="token punctuation">(</span><span class="token string">'fabcd'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>，运行结果为fab。
</code></pre></div><p><strong>日期函数</strong></p> <ul><li>CURRENT_DATE() 系统当前日期</li> <li>CURRENT_TIME() 系统当前时间，没有具体日期</li> <li>CURRENT_TIMESTAMP() 抽取具体的年、月、日</li> <li>DATE() 返回时间的日期部分</li> <li>YEAR() 返回时间的年份部分</li> <li>MONTH() 返回时间的月份部分</li> <li>DAY() 返回时间的天数部分</li> <li>HOUR() 返回时间的小时部分</li> <li>MINUTE() 返回时间的分钟部分</li> <li>SECOND() 返回时间的秒部分</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_DATE</span><span class="token punctuation">(</span><span class="token punctuation">)</span>，运行结果为<span class="token number">2019</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">03</span>。

<span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_TIME</span><span class="token punctuation">(</span><span class="token punctuation">)</span>，运行结果为<span class="token number">21</span>:<span class="token number">26</span>:<span class="token number">34</span>。

<span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>，运行结果为<span class="token number">2019</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">21</span>:<span class="token number">26</span>:<span class="token number">34</span>。

<span class="token keyword">SELECT</span> EXTRACT<span class="token punctuation">(</span><span class="token keyword">YEAR</span> <span class="token keyword">FROM</span> <span class="token string">'2019-04-03'</span><span class="token punctuation">)</span>，运行结果为<span class="token number">2019</span>。
<span class="token comment"># DATE日期格式必须是yyyy-mm-dd的形式。如果要进行日期比较，就要使用DATE函数，不要直接使用日期与字符串进行比较</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token string">'2019-04-01 12:00:05'</span><span class="token punctuation">)</span>，运行结果为<span class="token number">2019</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">01</span>。
</code></pre></div><p><strong>转换函数</strong></p> <ul><li>CAST() 数据类型转换，通过 AS 分隔 2 个参数分别是原始数据和目标数据类型</li> <li>COALESCE() 返回第一个非空数值</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 报错，小数不能转为整数</span>
<span class="token keyword">SELECT</span> CAST<span class="token punctuation">(</span><span class="token number">123.123</span> <span class="token keyword">AS</span> <span class="token keyword">INT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 精度8（整数+小数位最多8位），小数位数为2位</span>
<span class="token keyword">SELECT</span> CAST<span class="token punctuation">(</span><span class="token number">123.123</span> <span class="token keyword">AS</span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 返回第一个非空值</span>
<span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'hi'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>为什么使用 SQL 函数会带来问题？
版本兼容和不同的数据库可能不兼容。
大小写规范？
MYSQL 在 Linux，数据库名、表名、变量名严格区分大小写，字段名忽略大小写。而在 Windows 环境下全部不区分大小写。
所以</p> <ul><li>关键字和函数名称全部大写</li> <li>数据库名、表名、字段名全部小写</li> <li>分号结尾</li></ul> <p><img src="/assets/img/7.7469f764.png" alt=""></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 将 attack_growth 四舍五入一位</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> attack_growth<span class="token punctuation">,</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>attack_growth<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> heros<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>hp_max<span class="token punctuation">)</span> <span class="token keyword">FROM</span> heros<span class="token punctuation">;</span>
<span class="token comment"># 想显示英雄的名字，以及他们的名字字数，需要用到CHAR_LENGTH函数。</span>
<span class="token keyword">SELECT</span> CHAR_LENGTH<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> hp_max <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> hp_max <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>hp_max<span class="token punctuation">)</span> <span class="token keyword">FROM</span> heros<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 假如想要提取英雄上线日期（对应字段birthdate）的年份，只显示有上线日期的英雄即可（有些英雄没有上线日期的数据，不需要显示）</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>birthdate<span class="token punctuation">)</span> <span class="token keyword">AS</span> birthdate <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> birthdate <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> EXTRACT<span class="token punctuation">(</span><span class="token keyword">YEAR</span> <span class="token keyword">FROM</span> birthdate<span class="token punctuation">)</span> <span class="token keyword">AS</span> birthdate <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> birthdate <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>

<span class="token comment"># 假设我们需要找出在2016年10月1日之后上线的所有英雄。这里我们可以采用DATE函数来判断birthdate的日期是否大于2016-10-01，即WHERE DATE(birthdate)&gt;'2016-10-01'，然后再显示符合要求的全部字段信息</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> birthdate <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>birthdate<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token string">'2016-10-01'</span><span class="token punctuation">;</span>

<span class="token comment"># 假设我们需要知道在2016年10月1日之后上线英雄的平均最大生命值、平均最大法力和最高物攻最大值。同样我们需要先筛选日期条件，即WHERE DATE(birthdate)&gt;'2016-10-01'，然后再选择AVG(hp_max), AVG(mp_max), MAX(attack_max)字段进行显示。</span>

<span class="token keyword">SElECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>hp_max<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>mp_max<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>attack_max<span class="token punctuation">)</span> <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>birthdate<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token string">'2016-10-01'</span><span class="token punctuation">;</span>

<span class="token comment"># 计算英雄的最大生命平均值；显示出所有在2017年之前上线的英雄，如果英雄没有统计上线日期则不显示。</span>
<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>hp_max<span class="token punctuation">)</span>  <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> birthdate <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token operator">AND</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>birthdate<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token string">'2017'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_8-聚集函数"><a href="#_8-聚集函数" aria-hidden="true" class="header-anchor">#</a> 8 聚集函数</h2> <p>用于对一组数据进行汇总的函数，输入是一组数据的集合，输出是单个值。</p> <p>目标：</p> <ul><li>聚集函数有哪些，能否在一条 SELECT 语句中使用多个聚集函数。</li> <li>如何对数据进行分组，并进行聚集统计。</li> <li>如何使用 HAVING 过滤分组，HAVING 和 WHERE 的区别是什么。</li></ul> <h3 id="_5-个聚集函数"><a href="#_5-个聚集函数" aria-hidden="true" class="header-anchor">#</a> 5 个聚集函数</h3> <ul><li>COUNT() 总行数</li> <li>MAX()</li> <li>MIN()</li> <li>SUM()</li> <li>AVG()</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 查询最大生命值大于6000的英雄数量</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> hp_max <span class="token operator">&gt;</span> <span class="token number">6000</span><span class="token punctuation">;</span>

<span class="token comment"># 查询最大生命值大于6000，且有次要定位的英雄数量，需要使用COUNT函数。</span>
<span class="token comment"># COUNT(x) 会忽略 x 为 NULL 的数据行</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>role_assist<span class="token punctuation">)</span> <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> hp_max <span class="token operator">&gt;</span> <span class="token number">6000</span><span class="token punctuation">;</span>

<span class="token comment"># 查询射手（主要定位或者次要定位是射手）的最大生命值的最大值是多少，需要使用MAX函数</span>
<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>hp_max<span class="token punctuation">)</span> <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> role_main <span class="token operator">=</span> <span class="token string">'射手'</span> <span class="token operator">OR</span> role_assist <span class="token operator">=</span> <span class="token string">'射手'</span><span class="token punctuation">;</span>

<span class="token comment"># 如果想要知道英雄的数量，我们使用的是COUNT(*)函数，求平均值、最大值、最小值，以及总的防御最大值，我们分别使用的是AVG、MAX、MIN和SUM函数。</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>hp_max<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>mp_max<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>attack_max<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>defense_max<span class="token punctuation">)</span> <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> role_main <span class="token operator">=</span> <span class="token string">'射手'</span> <span class="token operator">or</span> role_assist <span class="token operator">=</span> <span class="token string">'射手'</span><span class="token punctuation">;</span>

<span class="token comment"># MAX和MIN函数也可以用于字符串类型数据的统计，如果是英文字母，则按照A—Z的顺序排列，越往后，数值越大。如果是汉字则按照全拼拼音进行排列。先把name字段统一转化为gbk类型，使用CONVERT(name USING gbk)，然后再使用MIN和MAX取最小值和最大值。</span>
<span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token keyword">CONVERT</span><span class="token punctuation">(</span>name <span class="token keyword">USING</span> gbk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token keyword">CONVERT</span><span class="token punctuation">(</span>name <span class="token keyword">USING</span> gbk<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> heros<span class="token punctuation">;</span>

<span class="token comment"># 想要查询不同的生命最大值的英雄数量是多少</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> hp_max<span class="token punctuation">)</span> <span class="token keyword">FROM</span> heros<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> birthdate <span class="token keyword">FROM</span> heros<span class="token punctuation">;</span>

<span class="token comment"># 不同生命最大值英雄的平均生命最大值，保留小数点后两位。</span>
<span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">AVG</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> hp_max<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token keyword">FROM</span> heros<span class="token punctuation">;</span>
</code></pre></div><p>对数据进行分组，并进行聚合统计</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 想按照英雄的主要定位进行分组，并统计每组的英雄数量。</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> role_main <span class="token keyword">FROM</span> heros <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> role_main<span class="token punctuation">;</span>
<span class="token comment"># 按次要定位进行分组</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> role_assist <span class="token keyword">FROM</span> heros <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> role_assist<span class="token punctuation">;</span>

<span class="token comment"># 按照英雄的主要定位、次要定位进行分组，查看这些英雄的数量，并按照这些分组的英雄数量从高到低进行排序</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> num<span class="token punctuation">,</span> role_main<span class="token punctuation">,</span> role_assist <span class="token keyword">FROM</span> heros <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> role_main<span class="token punctuation">,</span> role_assist <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> num <span class="token keyword">DESC</span><span class="token punctuation">;</span>

<span class="token comment"># 按照英雄的主要定位、次要定位进行分组，并且筛选分组中英雄数量大于5的组，最后按照分组中的英雄数量从高到低进行排序</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num<span class="token punctuation">,</span> role_main<span class="token punctuation">,</span> role_assist <span class="token keyword">FROM</span> heros <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> role_main<span class="token punctuation">,</span> role_assist <span class="token keyword">HAVING</span> num <span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> num <span class="token keyword">DESC</span><span class="token punctuation">;</span>


<span class="token comment"># 筛选最大生命值大于6000的英雄，按照主要定位、次要定位进行分组，并且显示分组中英雄数量大于5的分组，按照数量从高到低进行排序。</span>
<span class="token keyword">SElECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num<span class="token punctuation">,</span> role_main<span class="token punctuation">,</span> role_assist <span class="token keyword">FROM</span> heros <span class="token keyword">WHERE</span> hp_max <span class="token operator">&gt;</span> <span class="token number">6000</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> role_main<span class="token punctuation">,</span> role_assist <span class="token keyword">HAVING</span> num <span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> num <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre></div><p>WHERE 用于对数据行进行过滤，HAVING 用于对分组进行过滤。并且 HAVING 支持所有 WHERE 操作。</p> <div class="language- extra-class"><pre class="language-text"><code>SELECT ... FROM ... WHERE ... GROUP BY ... HAVING ... ORDER BY ...
</code></pre></div><p><img src="/assets/img/8.3aa2b062.png" alt=""></p> <h2 id="_9-子查询"><a href="#_9-子查询" aria-hidden="true" class="header-anchor">#</a> 9 子查询</h2> <p>嵌套在查询中的查询叫做子查询。</p> <p>目标：</p> <ul><li>子查询可以分为关联子查询和非关联子查询</li> <li>子查询关键词</li> <li>子查询怎么作为主查询的列</li></ul> <p>子查询从数据表查询了结果，如果这个数据结果只执行一次，然后这个结果作为主查询的条件进行执行，这样的子查询叫做非关联子查询。</p> <p>如果子查询需要执行多次，即采用循环的方式，先从外部查询开始，每次都传入子查询进行查询，然后再将结果反馈给外部，这样的嵌套执行方式叫做关联子查询。</p> <h2 id="_10-常用的-sql-标准和连接"><a href="#_10-常用的-sql-标准和连接" aria-hidden="true" class="header-anchor">#</a> 10 常用的 SQL 标准和连接</h2> <p>SQL 的核心就是关系，关系的核心就是连接。 SQL 有 2 个主要的标准：SQL92(SQL-2) 和 SQL99(SQL-3)。</p> <p>SQL92 的 5 种连接方式：笛卡尔积、等值连接、非等值连接、外连接(左连接、右连接)和自连接。</p> <p><strong>笛卡尔积</strong></p> <p>X 和 Y 的笛卡尔积就是 X 和 Y 的所有可能组合。</p> <p>笛卡尔积也叫做交叉连接（CROSS JOIN)，它的作用就是把任意表进行连接，即使两个表不相关。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> player<span class="token punctuation">,</span> team_score<span class="token punctuation">;</span>
</code></pre></div><p><strong>等值连接</strong></p> <p>等值连接就是将两张表中都存在的列进行连接。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> player_id<span class="token punctuation">,</span> player<span class="token punctuation">.</span>team_id<span class="token punctuation">,</span> player_name<span class="token punctuation">,</span> height<span class="token punctuation">,</span> team_name <span class="token keyword">FROM</span> player<span class="token punctuation">,</span> team <span class="token keyword">WHERE</span> player<span class="token punctuation">.</span>team_id <span class="token operator">=</span> team<span class="token punctuation">.</span>team_id<span class="token punctuation">;</span>

<span class="token comment"># 上面可以使用别名，但是一旦用了别名，查询中的子段也需要用别名</span>
<span class="token keyword">SELECT</span> player_id<span class="token punctuation">,</span> a<span class="token punctuation">.</span>team_id<span class="token punctuation">,</span> player_name<span class="token punctuation">,</span> height<span class="token punctuation">,</span> team_name <span class="token keyword">FROM</span> player <span class="token keyword">AS</span> a<span class="token punctuation">,</span> team <span class="token keyword">AS</span> b <span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>team_id <span class="token operator">=</span> b<span class="token punctuation">.</span>team_id<span class="token punctuation">;</span>
</code></pre></div><p><strong>非等值连接</strong></p> <p>当进行多表查询时，如果连接多个表的条件是等号时，就是等值连接，其它的运算符连接就是非等值连接。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 查询每个球员的身高级别</span>
<span class="token keyword">SELECT</span> player_name<span class="token punctuation">,</span> height_level <span class="token keyword">from</span> player <span class="token keyword">AS</span> a<span class="token punctuation">,</span> height_grades <span class="token keyword">AS</span> b <span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>height <span class="token operator">BETWEEN</span> b<span class="token punctuation">.</span>height_lowest <span class="token operator">AND</span> b<span class="token punctuation">.</span>height_highest<span class="token punctuation">;</span>
</code></pre></div><p><strong>外连接</strong></p> <p>左外连接就是左边的表为主表，需要显示左边表的全部行，而右侧的表是从表，(+) 表示哪个是从表。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># sql92</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> player<span class="token punctuation">,</span> team <span class="token keyword">where</span> player<span class="token punctuation">.</span>team_id <span class="token operator">=</span> team<span class="token punctuation">.</span>team_id<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># sql99</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> player <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> team <span class="token keyword">on</span> player<span class="token punctuation">.</span>team_id <span class="token operator">=</span> team<span class="token punctuation">.</span>team_id<span class="token punctuation">;</span>
</code></pre></div><p><strong>自连接</strong></p> <p>查询条件中使用了当前表的字段。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> b<span class="token punctuation">.</span>player_name<span class="token punctuation">,</span> b<span class="token punctuation">.</span>height <span class="token keyword">FROM</span> player <span class="token keyword">as</span> a<span class="token punctuation">,</span> player <span class="token keyword">as</span> b <span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>player_name <span class="token operator">=</span> <span class="token string">'布雷克-格里芬'</span> <span class="token operator">and</span> a<span class="token punctuation">.</span>height <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

<span class="token comment"># 不用自连接，需要查询两次</span>
<span class="token keyword">SELECT</span> player_name<span class="token punctuation">,</span> height <span class="token keyword">FROM</span> player <span class="token keyword">WHERE</span> height <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> height <span class="token keyword">FROM</span> player <span class="token keyword">WHERE</span> player_name <span class="token operator">=</span> <span class="token string">'布雷克-格里芬'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/assets/img/10.b276698a.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5c51376b.js" defer></script><script src="/assets/js/2.8c0114de.js" defer></script><script src="/assets/js/6.7b7b0c6e.js" defer></script>
  </body>
</html>
