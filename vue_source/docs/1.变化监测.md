# 变化监测

## 变化监测

渲染： dom 输出到页面上显示
变化监测：数据变化时，通知视图更新

变化监测两种方案：推(vue)、拉(angular 脏检测、 react 虚拟 dom)

推：状态变化时，vue 立马会知道哪些状态变了，所以能进行更细粒度的更新。缺点粒度越细，每个状态绑定的依赖越多，依赖跟踪在内存上开销越大。所以 vue2.0 开始，引入了虚拟 DOM，将粒度调整为中等(即组件、而不是具体的 DOM)。这可以大大降低依赖数量，降低依赖跟踪所消耗的内存。
更细粒度的更细：假设一个状态绑定了多个依赖，每个依赖对应一个 dom 节点，当状态变化时，像这个状态的所有依赖发送通知，进行更新。相对来说，拉 的粒度是最粗的。

## Object 的变化监测

首先搜集依赖(就是 Watcher)，数据变化时，再通知组件，组件内部再通过虚拟 DOM 重新渲染。
tip: 在 getter 中搜集依赖，在 setter 中触发依赖。只有 Watcher 触发了 getter 才会收集依赖，哪个 Watcher 触发了 getter，就把 Watcher 收集到 dep 中。

方案：

1. Object.defineProperty

存在的问题是只能监听修改，而无法监听属性的新增和删除，在新增属性、delete 删除属性时无法通知 dep 更新，为了解决这个问题，vue 提供了 2 个 API： vm.$set 和 vm.$delete 。

2. es6 Proxy
